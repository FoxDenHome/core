on: [push]

concurrency:
  cancel-in-progress: true
  group: lint-${{ github.ref }}

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: https://github.com/astral-sh/setup-uv@v7
      - uses: https://github.com/cachix/install-nix-action@v31
        with:
          nix_path: nixpkgs=channel:nixos-unstable
      - name: Lint nix
        run: |
          cd ./nix
          treefmt --ci
      - name: Lint mikrotik
        run: |
          cd ./mikrotik
          uv run ruff check

      - uses: https://github.com/terraform-linters/setup-tflint@v5
        name: Setup TFLint
        with:
          tflint_version: v0.59.1

      - name: Init TFLint
        run: tflint --init

      - name: Run TFLint
        run: tflint -c "${PWD}/terraform/.tflint.hcl" --recursive -f compact
