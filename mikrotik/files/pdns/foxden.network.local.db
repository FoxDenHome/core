config IN LUA LUA  ("if not foxden_local then"
                    "  local cache = {}"
                    "  function foxden_local(suffix)"
                    "    local loc = cache[suffix]"
                    "    if loc then"
                    "      return loc"
                    "    end"
                    "    loc = {}"
                    "    local ipv6 = not suffix:find('.', 1, true)"
                    "    local defDest"
                    "    for subnet = 1,9 do"
                    "      local src = {'10.' .. subnet .. '.0.0/16', 'fd2c:f4cb:63be:' .. subnet .. '::/64'}"
                    "      local dest"
                    "      if ipv6 then"
                    "        dest = {'fd2c:f4cb:63be:' .. subnet .. '::' .. suffix}"
                    "      else"
                    "        dest = {'10.' .. subnet .. '.' .. suffix}"
                    "      end"
                    "      table.insert(loc, {src, dest})"
                    "      if subnet == 2 then"
                    "        defDest = dest"
                    "      end"
                    "    end"
                    "    if (not ipv6) and suffix:sub(1, 2) == '1.' then"
                    "      local shortSuffix = suffix:sub(3)"
                    "      table.insert(loc, {{'100.96.41.0/24'}, {'100.96.41.'..shortSuffix}})"
                    "    end"
                    "    table.insert(loc, {{'0.0.0.0/0', '::/0'}, defDest})"
                    "    cache[suffix] = loc"
                    "    return loc"
                    "  end"
                    "end")

gateway       IN LUA A       (";include('config'); return view(foxden_local('0.1'));")
gateway       IN LUA AAAA    (";include('config'); return view(foxden_local('0001'));")
dns           IN LUA A       (";include('config'); return view(foxden_local('0.53'));")
dns           IN LUA AAAA    (";include('config'); return view(foxden_local('0035'));")
ntp           IN LUA A       (";include('config'); return view(foxden_local('0.12'));")
ntp           IN LUA AAAA    (";include('config'); return view(foxden_local('007b'));")
router        IN LUA A       (";include('config'); return view(foxden_local('1.1'));")
router        IN LUA AAAA    (";include('config'); return view(foxden_local('0101'));")
router-backup IN LUA A       (";include('config'); return view(foxden_local('1.2'));")
router-backup IN LUA AAAA    (";include('config'); return view(foxden_local('0102'));")
ntpi          IN LUA A       (";include('config'); return view(foxden_local('1.123'));")
ntpi          IN LUA AAAA    (";include('config'); return view(foxden_local('017b'));")

ecstest 0 IN LUA TXT ("bestwho:toString()")
